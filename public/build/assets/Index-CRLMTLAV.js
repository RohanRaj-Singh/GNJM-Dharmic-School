import{u as w,r as l,j as s,a as o,z as r}from"./app-DMgsIovw.js";import{A as R}from"./AdminLayout-DlV8HObD.js";import{u as A,f as m,g as F,b as E}from"./index-C9T86V1J.js";function U(){const{fees:x,filters:a}=w().props,h=x??[],[p,g]=l.useState([]),[f,b]=l.useState([]),[j,c]=l.useState([]),i=2025,v=new Date().getFullYear(),C=Array.from({length:v-i+1},(e,t)=>i+t),y=[{label:"All",value:""},{label:"Paid",value:"paid"},{label:"Unpaid",value:"unpaid"}];l.useEffect(()=>{fetch("/admin/classes/options").then(e=>e.json()).then(b)},[]),l.useEffect(()=>{if(!a?.class_id){c([]);return}fetch(`/admin/sections/options?class_id=${a.class_id}`).then(e=>e.json()).then(c)},[a?.class_id]);function d(e){o.post(route("admin.fees.collect",e),{},{preserveScroll:!0,onSuccess:()=>r.success("Fee collected")})}function N(e){confirm("Un-collect this fee?")&&o.post(route("admin.fees.deCollect",e),{},{preserveScroll:!0,onSuccess:()=>r.success("Fee un-collected")})}function S(e){confirm("Delete this custom fee for all students?")&&o.delete(route("admin.fees.custom.destroy",e),{preserveScroll:!0,onSuccess:()=>r.success("Custom fee deleted")})}const _=l.useMemo(()=>[{header:"#",cell:({row:e})=>e.index+1},{accessorKey:"student_name",header:"Student"},{accessorKey:"class_name",header:"Class"},{accessorKey:"section_name",header:"Section"},{header:"Fee",cell:({row:e})=>e.original.type==="monthly"?e.original.month:e.original.title},{header:"Amount",cell:({row:e})=>`Rs ${e.original.amount}`},{header:"Status",cell:({row:e})=>e.original.is_paid?s.jsx("span",{className:"text-green-600 font-medium",children:"✔ Paid"}):s.jsx("span",{className:"text-red-600 font-medium",children:"Unpaid"})},{header:"Action",cell:({row:e})=>{const t=e.original;return t.is_paid?s.jsx("button",{onClick:()=>N(t.id),className:"text-yellow-600 text-sm",children:"Un-collect"}):t.source==="custom"?s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>d(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm",children:"Collect"}),s.jsx("button",{onClick:()=>S(t.batch_id),className:"text-red-600 text-sm",children:"Delete"})]}):s.jsx("button",{onClick:()=>d(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm",children:"Collect"})}}],[]),u=A({data:h,columns:_,state:{sorting:p},onSortingChange:g,getCoreRowModel:E(),getSortedRowModel:F()});function n(e,t){o.get(route("admin.fees.index"),{...a,[e]:t,...e==="class_id"?{section_id:""}:{}},{preserveState:!1,replace:!0})}return s.jsxs(R,{title:"Fees",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.year??"",onChange:e=>n("year",e.target.value),children:[s.jsx("option",{value:"",children:"Year: All"}),C.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.class_id??"",onChange:e=>n("class_id",e.target.value),children:[s.jsx("option",{value:"",children:"Class: All"}),f.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.section_id??"",disabled:!a?.class_id,onChange:e=>n("section_id",e.target.value),children:[s.jsx("option",{value:"",children:"Section: All"}),j.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:y.map(e=>{const t=(a?.status??"")===e.value;return s.jsx("button",{onClick:()=>n("status",e.value),className:`px-3 py-1 text-sm rounded-md transition
          ${t?"bg-white shadow text-blue-600 font-medium":"text-gray-600 hover:text-black"}`,children:e.label},e.value||"all")})}),s.jsx("input",{className:"border px-3 py-2 rounded text-sm w-64",placeholder:"Search student…",defaultValue:a?.search??"",onChange:e=>n("search",e.target.value)})]}),s.jsx("div",{className:"bg-white border rounded-lg overflow-x-auto",children:s.jsxs("table",{className:"min-w-[1000px] text-sm",children:[s.jsx("thead",{className:"bg-gray-50 border-b",children:u.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(t=>s.jsx("th",{className:"px-3 py-2 text-left",children:m(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),s.jsx("tbody",{children:u.getRowModel().rows.map(e=>s.jsx("tr",{className:"border-b",children:e.getVisibleCells().map(t=>s.jsx("td",{className:"px-3 py-2",children:m(t.column.columnDef.cell,t.getContext())},t.id))},e.id))})]})})]})}export{U as default};
