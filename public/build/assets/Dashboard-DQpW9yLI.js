import{r as n,j as e}from"./app-CU8RJ2JX.js";import{A as w}from"./AdminLayout-DtTgDvcV.js";import{f as o}from"./helper-BxvJq_M8.js";function d({label:l,value:i,sub:r,accent:c="bg-slate-700"}){return e.jsxs("div",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:l}),e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${c}`})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800",children:i}),r?e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:r}):null]})}function v({label:l,value:i,total:r,tone:c="bg-blue-600",suffix:m=""}){const a=r>0?Math.max(0,Math.min(100,Math.round(i/r*100))):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-slate-600",children:l}),e.jsxs("span",{className:"font-medium text-slate-800",children:[i,m]})]}),e.jsx("div",{className:"h-2 rounded-full bg-slate-100 overflow-hidden",children:e.jsx("div",{className:`h-full ${c}`,style:{width:`${a}%`}})})]})}function D(){const l=new Date().getFullYear(),[i,r]=n.useState(String(l)),[c,m]=n.useState(!0),[a,N]=n.useState(null),[p,j]=n.useState(""),[h,b]=n.useState("gurmukhi"),[x,g]=n.useState("all");n.useEffect(()=>{m(!0),j(""),fetch(`/admin/dashboard/summary?year=${i}`).then(async s=>{if(!s.ok)throw new Error("Failed to load dashboard summary");return s.json()}).then(s=>{N(s),(s?.divisions??[]).some(y=>y.type===h)||b(s?.divisions?.[0]?.type??"gurmukhi")}).catch(s=>{j(s.message||"Unable to load dashboard data")}).finally(()=>m(!1))},[i]);const t=n.useMemo(()=>(a?.divisions??[]).find(s=>s.type===h)??null,[a,h]),u=n.useMemo(()=>!t||x==="all"?null:t.classes.find(s=>String(s.id)===String(x))??null,[t,x]),f=u?u.sections:[];return e.jsx(w,{title:"Dashboard",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white border rounded-xl px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-800",children:"School Admin Dashboard"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Fees, attendance and division performance in one operational view."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs uppercase text-slate-500",children:"Year"}),e.jsx("select",{value:i,onChange:s=>r(s.target.value),className:"border rounded-md px-2 py-1.5 text-sm",children:[l-2,l-1,l,l+1].map(s=>e.jsx("option",{value:String(s),children:s},s))})]})]})}),c?e.jsx("div",{className:"bg-white border rounded-xl p-6 text-sm text-slate-500",children:"Loading dashboard..."}):null,!c&&p?e.jsx("div",{className:"bg-white border rounded-xl p-6 text-sm text-rose-600",children:p}):null,!c&&!p&&a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-3",children:[e.jsx(d,{label:"Total Fees",value:o(a.fees.total),accent:"bg-blue-600"}),e.jsx(d,{label:"Collected",value:o(a.fees.collected),accent:"bg-emerald-600"}),e.jsx(d,{label:"Pending",value:o(a.fees.pending),accent:"bg-rose-600"}),e.jsx(d,{label:"Collection Rate",value:`${a.fees.percentage}%`,sub:"Collected / Total",accent:"bg-violet-600"}),e.jsx(d,{label:"Active Students",value:a.students.active,sub:`${a.students.total} total students`,accent:"bg-amber-500"})]}),e.jsxs("div",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("div",{className:"inline-flex border rounded-lg p-1 bg-slate-50",children:(a.divisions??[]).map(s=>e.jsx("button",{onClick:()=>{b(s.type),g("all")},className:`px-3 py-1.5 rounded-md text-sm border ${h===s.type?"bg-emerald-600 border-emerald-600 text-white":"bg-white border-slate-200 text-slate-700 hover:bg-slate-100"}`,children:s.title},s.type))}),t?e.jsxs("select",{value:x,onChange:s=>g(s.target.value),className:"border rounded-md px-2 py-1.5 text-sm",children:[e.jsxs("option",{value:"all",children:["All Classes (",t.title,")"]}),t.classes.map(s=>e.jsx("option",{value:String(s.id),children:s.name},s.id))]}):null]}),t?e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"xl:col-span-1 border rounded-lg p-3 bg-slate-50/60",children:[e.jsxs("p",{className:"text-xs uppercase text-slate-500 mb-3",children:[t.title," Overview"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{label:"Division Fee Collection",value:t.fees.collected,total:Math.max(1,t.fees.total),tone:"bg-emerald-600",suffix:""}),e.jsx(v,{label:"Division Attendance (Present %)",value:t.attendance.percentage,total:100,tone:"bg-blue-600",suffix:"%"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-1",children:[e.jsx(d,{label:"Classes",value:t.stats.classes_count,accent:"bg-slate-600"}),e.jsx(d,{label:"Sections",value:t.stats.sections_count,accent:"bg-slate-600"}),e.jsx(d,{label:"Students",value:t.stats.students_count,accent:"bg-amber-500"}),e.jsx(d,{label:"Active",value:t.stats.active_students_count,accent:"bg-emerald-600"})]})]})]}),e.jsxs("div",{className:"xl:col-span-2 space-y-4",children:[e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 bg-slate-50 border-b text-sm font-medium text-slate-700",children:"Class Performance"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white border-b text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Class"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Students"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Fees"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Collection %"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Attendance %"})]})}),e.jsx("tbody",{children:t.classes.filter(s=>x==="all"||String(s.id)===String(x)).map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2 font-medium text-slate-800",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:s.students_count}),e.jsx("td",{className:"px-3 py-2",children:o(s.fees.total)}),e.jsxs("td",{className:"px-3 py-2",children:[s.fees.percentage,"%"]}),e.jsxs("td",{className:"px-3 py-2",children:[s.attendance.percentage,"%"]})]},s.id))})]})})]}),x!=="all"?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 bg-slate-50 border-b text-sm font-medium text-slate-700",children:["Section Summary ",u?`- ${u.name}`:""]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white border-b text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Section"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Students"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Fees"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Collection %"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Attendance %"})]})}),e.jsxs("tbody",{children:[f.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2 font-medium text-slate-800",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:s.students_count}),e.jsx("td",{className:"px-3 py-2",children:o(s.fees.total)}),e.jsxs("td",{className:"px-3 py-2",children:[s.fees.percentage,"%"]}),e.jsxs("td",{className:"px-3 py-2",children:[s.attendance.percentage,"%"]})]},s.id)),f.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-slate-400",colSpan:5,children:"No sections found for this class."})}):null]})]})})]}):e.jsx("div",{className:"border rounded-lg p-3 bg-slate-50 text-sm text-slate-500",children:"Select a class to view section-level summaries."})]})]}):e.jsx("div",{className:"text-sm text-slate-500",children:"No division data found."})]}),e.jsxs("div",{className:"text-xs text-right text-slate-400",children:["Last updated: ",a.meta.generated_at]})]}):null]})})}export{D as default};
