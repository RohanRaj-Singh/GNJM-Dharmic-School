import{r as l,j as s,z as c,a as R}from"./app-DJfHBbO4.js";import{A as _}from"./AdminLayout-Z3678DNH.js";import{u as F,f,g as M,a as I,b as A}from"./index-BtBcHxdd.js";function V(){const[o,r]=l.useState([]),[h,b]=l.useState([]),[u,m]=l.useState(""),x=l.useRef(null);function g(){fetch("/admin/classes/data").then(e=>e.json()).then(r)}l.useEffect(g,[]);function i(e,t,a){r(d=>d.map((n,S)=>S===e?{...n,[t]:a}:n))}function j({row:e,column:t,autoFocus:a=!1}){const d=a?x:null;return s.jsx("input",{ref:d,defaultValue:e.original[t.id]??"",className:"w-full px-2 py-1 border rounded text-sm",onBlur:n=>i(e.index,t.id,n.target.value)})}function y({row:e,column:t}){return s.jsx("input",{type:"number",min:0,defaultValue:e.original[t.id]??0,className:"w-full px-2 py-1 border rounded text-sm",onBlur:a=>i(e.index,t.id,Number(a.target.value||0))})}function v({row:e,column:t}){return s.jsxs("select",{defaultValue:e.original[t.id]??"active",className:"w-full px-2 py-1 border rounded text-sm",onChange:a=>i(e.index,t.id,a.target.value),children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"})]})}const C=l.useMemo(()=>[{accessorKey:"name",header:"Class Name",cell:({row:e,column:t})=>s.jsx(j,{row:e,column:t,autoFocus:e.original.__isNew})},{accessorKey:"default_monthly_fee",header:"Monthly Fee",cell:({row:e,column:t})=>s.jsx(y,{row:e,column:t})},{accessorKey:"sections_count",header:"Sections",cell:({row:e})=>s.jsx("span",{className:"text-gray-600",children:e.original.sections_count??0})},{accessorKey:"status",header:"Status",cell:({row:e,column:t})=>s.jsx(v,{row:e,column:t})}],[]),p=F({data:o,columns:C,getRowId:e=>e.id?`class-${e.id}`:e.__tempId,state:{sorting:h,globalFilter:u},onSortingChange:b,onGlobalFilterChange:m,getCoreRowModel:A(),getFilteredRowModel:I(),getSortedRowModel:M(),globalFilterFn:"includesString"});function N(){const e={id:null,__tempId:crypto.randomUUID(),name:"",default_monthly_fee:0,status:"active",sections_count:0,__isNew:!0};r(t=>[e,...t]),requestAnimationFrame(()=>{x.current?.focus()})}function w(){if(o.some(e=>!e.name?.trim())){c.error("Class name cannot be empty");return}R.post("/admin/classes/save",{classes:o},{onSuccess:()=>{c.success("Classes saved"),g()},onError:()=>c.error("Save failed")})}return s.jsxs(_,{title:"Classes",children:[s.jsxs("div",{className:"flex flex-wrap justify-between gap-3 mb-4",children:[s.jsx("input",{className:"px-3 py-2 border rounded text-sm w-64",placeholder:"Search classes…",value:u,onChange:e=>m(e.target.value)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"+ Add Class"}),s.jsx("button",{onClick:w,className:"px-4 py-2 bg-green-600 text-white rounded",children:"Save Changes"})]})]}),s.jsx("div",{className:"bg-white border rounded overflow-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50 border-b",children:p.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(t=>s.jsxs("th",{className:"px-3 py-2 text-left font-medium cursor-pointer",onClick:t.column.getToggleSortingHandler(),children:[f(t.column.columnDef.header,t.getContext()),{asc:" ↑",desc:" ↓"}[t.column.getIsSorted()]??""]},t.id))},e.id))}),s.jsx("tbody",{children:p.getRowModel().rows.map(e=>s.jsx("tr",{className:"border-b hover:bg-gray-50",children:e.getVisibleCells().map(t=>s.jsx("td",{className:"px-3 py-2",children:f(t.column.columnDef.cell,t.getContext())},t.id))},e.id))})]})})]})}export{V as default};
