import{u as E,r as l,j as s,a as r,z as o}from"./app-Ckh2FTtI.js";import{A as k}from"./AdminLayout-CbIuyABR.js";import{u as M,f as x,g as D,b as U}from"./index-B4pRF02u.js";function I(){const{fees:h,filters:a}=E().props,p=h??[],[g,f]=l.useState([]),[b,v]=l.useState([]),[j,c]=l.useState([]),[C,i]=l.useState(a?.search??"");l.useRef(null);const d=2025,S=new Date().getFullYear(),y=Array.from({length:S-d+1},(e,t)=>d+t),N=[{label:"All",value:""},{label:"Paid",value:"paid"},{label:"Unpaid",value:"unpaid"}];l.useEffect(()=>{fetch("/admin/classes/options").then(e=>e.json()).then(v)},[]),l.useEffect(()=>{if(!a?.class_id){c([]);return}fetch(`/admin/sections/options?class_id=${a.class_id}`).then(e=>e.json()).then(c)},[a?.class_id]),l.useEffect(()=>{i(a?.search??"")},[a?.search]);function u(e){r.post(route("admin.fees.collect",e),{},{preserveScroll:!0,onSuccess:()=>o.success("Fee collected")})}function _(e){confirm("Un-collect this fee?")&&r.post(route("admin.fees.deCollect",e),{},{preserveScroll:!0,onSuccess:()=>o.success("Fee un-collected")})}function R(e){confirm("Delete this custom fee for all students?")&&r.delete(route("admin.fees.custom.destroy",e),{preserveScroll:!0,onSuccess:()=>o.success("Custom fee deleted")})}const w=l.useMemo(()=>[{header:"#",cell:({row:e})=>e.index+1},{accessorKey:"student_name",header:"Student"},{accessorKey:"class_name",header:"Class"},{accessorKey:"section_name",header:"Section"},{header:"Fee",cell:({row:e})=>e.original.type==="monthly"?e.original.month:e.original.title},{header:"Amount",cell:({row:e})=>`Rs ${e.original.amount}`},{header:"Status",cell:({row:e})=>e.original.is_paid?s.jsx("span",{className:"text-green-600 font-medium",children:"âœ” Paid"}):s.jsx("span",{className:"text-red-600 font-medium",children:"Unpaid"})},{header:"Action",cell:({row:e})=>{const t=e.original;return t.is_paid?s.jsx("button",{onClick:()=>_(t.id),className:"text-yellow-600 text-sm",children:"Un-collect"}):t.source==="custom"?s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>u(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm",children:"Collect"}),s.jsx("button",{onClick:()=>R(t.batch_id),className:"text-red-600 text-sm",children:"Delete"})]}):s.jsx("button",{onClick:()=>u(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm",children:"Collect"})}}],[]),m=M({data:p,columns:w,state:{sorting:g},onSortingChange:f,getCoreRowModel:U(),getSortedRowModel:D()}),n=l.useCallback((e,t,F={})=>{r.get(route("admin.fees.index"),{...a,[e]:t,...e==="class_id"?{section_id:""}:{}},{preserveState:F.preserveState??!1,replace:!0})},[a]),A=l.useCallback(e=>{(a?.search??"")!==e&&n("search",e,{preserveState:!0})},[n,a?.search]);return s.jsxs(k,{title:"Fees",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.year??"",onChange:e=>n("year",e.target.value),children:[s.jsx("option",{value:"",children:"Year: All"}),y.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.class_id??"",onChange:e=>n("class_id",e.target.value),children:[s.jsx("option",{value:"",children:"Class: All"}),b.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:a?.section_id??"",disabled:!a?.class_id,onChange:e=>n("section_id",e.target.value),children:[s.jsx("option",{value:"",children:"Section: All"}),j.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:N.map(e=>{const t=(a?.status??"")===e.value;return s.jsx("button",{onClick:()=>n("status",e.value),className:`px-3 py-1 text-sm rounded-md transition
          ${t?"bg-white shadow text-blue-600 font-medium":"text-gray-600 hover:text-black"}`,children:e.label},e.value||"all")})}),s.jsx("input",{className:"border px-3 py-2 rounded text-sm w-64",placeholder:"Search student...",value:C,onChange:e=>{const t=e.target.value;i(t),A(t)}})]}),s.jsx("div",{className:"bg-white border rounded-lg overflow-x-auto",children:s.jsxs("table",{className:"min-w-[1000px] text-sm",children:[s.jsx("thead",{className:"bg-gray-50 border-b",children:m.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(t=>s.jsx("th",{className:"px-3 py-2 text-left",children:x(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),s.jsx("tbody",{children:m.getRowModel().rows.map(e=>s.jsx("tr",{className:"border-b",children:e.getVisibleCells().map(t=>s.jsx("td",{className:"px-3 py-2",children:x(t.column.columnDef.cell,t.getContext())},t.id))},e.id))})]})})]})}export{I as default};
