import{r as f,j as n}from"./app-BlM1dy8g.js";function y({row:a,classes:x,sectionsByClass:u,loadSections:m,setData:p,setIsDirty:g}){const r=a.original.enrollments??[];f.useEffect(()=>{r.forEach(e=>{e.class_id&&m(e.class_id)})},[r,m]);const b=f.useMemo(()=>r.map(e=>String(e.class_id)).filter(Boolean),[r]);function o(e,s,i){console.log("UPDATE ENROLLMENT",e,s,i),p(l=>l.map((d,c)=>c!==a.index?d:{...d,enrollments:d.enrollments.map(t=>String(t.id)===String(e)?{...t,[s]:i}:t)})),g(!0)}function _(){p(e=>e.map((s,i)=>i!==a.index?s:{...s,enrollments:[...r,{id:crypto.randomUUID(),class_id:"",section_id:"",student_type:"paid"}]})),g(!0)}function j(e){p(s=>s.map((i,l)=>l!==a.index?i:{...i,enrollments:i.enrollments.filter(d=>d.id!==e)})),g(!0)}return n.jsxs("div",{className:"flex flex-col gap-2 min-w-[320px]",children:[r.map(e=>{const s=x.length>0,i=x.filter(t=>!b.includes(String(t.id))||String(t.id)===String(e.class_id)),l=!!e.class_id&&Array.isArray(u[String(e.class_id)]),d=u[String(e.class_id)]||[],c=e.student_type==="free";return n.jsxs("div",{className:`flex gap-2 items-center p-2 rounded border
              ${c?"bg-green-50 border-green-200":"bg-white"}
            `,children:[n.jsxs("select",{disabled:!s,value:s?String(e.class_id??""):"",onChange:t=>{const h=t.target.value;o(e.id,"class_id",h),o(e.id,"section_id",""),m(h)},className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[n.jsx("option",{value:"",children:s?"Class":"Loading…"}),i.map(t=>n.jsx("option",{value:String(t.id),children:t.name},t.id))]}),n.jsxs("select",{disabled:!l,value:l?String(e.section_id??""):"",onChange:t=>o(e.id,"section_id",t.target.value),className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[n.jsx("option",{value:"",children:l?"Section":"Loading…"}),d.map(t=>n.jsx("option",{value:String(t.id),children:t.name},t.id))]}),n.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer select-none",children:[n.jsx("input",{type:"checkbox",checked:e.student_type==="free",onChange:t=>{console.log("TOGGLE FREE",e.id,t.target.checked),o(e.id,"student_type",t.target.checked?"free":"paid")},className:"h-4 w-4 accent-green-600"}),n.jsx("span",{className:c?"text-green-700 font-medium":"text-gray-600",children:"Free"})]}),n.jsx("button",{type:"button",onClick:()=>j(e.id),className:"text-red-600 text-sm ml-auto",title:"Remove enrollment",children:"✕"})]},e.id)}),n.jsx("button",{type:"button",onClick:_,className:"text-blue-600 text-xs self-start mt-1",children:"+ Add Enrollment"})]})}export{y as default};
