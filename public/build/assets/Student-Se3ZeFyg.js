import{r as c,j as e}from"./app-BTyKEQgh.js";import{A as M}from"./AdminLayout-BJtCc5TE.js";import{M as S}from"./MultiSelect-BpNehzpf.js";import"./logo-CAn8f4K1.js";function G(){const s=new Date().getFullYear(),[l,d]=c.useState([]),[n,t]=c.useState(null),[r,y]=c.useState(s),[x,v]=c.useState(null),[o,m]=c.useState(null),[i,h]=c.useState(null),[p,u]=c.useState(!1),[g,$]=c.useState(null),A=c.useMemo(()=>l.map(a=>({value:a.id,label:`${a.name}${a.father_name?` (Father: ${a.father_name})`:""}`})),[l]),w=c.useMemo(()=>Array.from({length:5},(a,b)=>{const j=s-3+b;return{value:j,label:String(j)}}),[s]),C=c.useMemo(()=>r?["January","February","March","April","May","June","July","August","September","October","November","December"].map((b,j)=>({value:`${r}-${String(j+1).padStart(2,"0")}`,label:b})):[],[r]);c.useEffect(()=>{fetch("/admin/students/list",{headers:{Accept:"application/json"}}).then(a=>a.json()).then(d).catch(()=>d([]))},[]);async function R(){if(!(!n||!r)){if(x&&o&&x>o){alert("From month cannot be after To month");return}u(!0),$(null),h(null);try{const a=await fetch("/admin/reports/build",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({report:"student",student_id:n,year:r,month_from:x,month_to:o})});if(!a.ok){$("Failed to build report");return}h(await a.json())}finally{u(!1)}}}function P(){if(!n||!r)return;const a=document.createElement("form");a.method="POST",a.action="/admin/reports/export/pdf",a.target="_blank";const b=document.createElement("input");b.type="hidden",b.name="_token",b.value=document.querySelector('meta[name="csrf-token"]')?.content,a.appendChild(b),["report","student_id","year","month_from","month_to"].forEach(j=>{const k={report:"student",student_id:n,year:r,month_from:x,month_to:o}[j];if(k==null)return;const N=document.createElement("input");N.type="hidden",N.name=j,N.value=k,a.appendChild(N)}),document.body.appendChild(a),a.submit(),document.body.removeChild(a)}return e.jsxs(M,{title:"Student Report",children:[e.jsx(D,{studentOptions:A,yearOptions:w,monthOptions:C,studentId:n,year:r,monthFrom:x,monthTo:o,setStudentId:t,setYear:y,setMonthFrom:v,setMonthTo:m,loading:p,buildReport:R,exportPdf:P,report:i}),i&&e.jsxs(e.Fragment,{children:[e.jsx(E,{student:i.student}),e.jsx(O,{report:i}),e.jsx(F,{title:"Gurmukhi",fees:i.gurmukhi.fees}),console.log(i.gurmukhi.fees),e.jsx(_,{title:"Gurmukhi",attendance:i.gurmukhi.attendance}),e.jsx(F,{title:"Kirtan Fees",fees:i.kirtan.fees}),e.jsx(_,{title:"Kirtan",attendance:i.kirtan.attendance})]})]})}function E({student:s}){return e.jsxs("div",{className:"bg-white border rounded p-4 mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.name}),s.father_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Father: ",s.father_name]})]})}function O({report:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(f,{label:"Gurmukhi Pending",color:"text-red-600",value:`Rs. ${s.gurmukhi.fees.summary.pending}`}),e.jsx(f,{label:"Gurmukhi Attendance",color:"text-green-600",value:`${s.gurmukhi.attendance.summary.percentage}%`}),e.jsx(f,{label:"Kirtan Attendance",color:"text-green-600",value:`${s.kirtan.attendance.summary.percentage}%`}),e.jsx(f,{label:"Kirtan Performance",color:"text-blue-600",value:`${s.kirtan.performance.percentage}% (${s.kirtan.performance.rating})`})]})}function f({label:s,value:l,color:d}){return e.jsxs("div",{className:"border rounded p-3 bg-white",children:[e.jsx("div",{className:"text-xs text-gray-500",children:s}),e.jsx("div",{className:`text-lg font-semibold ${d}`,children:l})]})}function _({title:s,attendance:l}){if(!l||!l.calendar||Object.keys(l.calendar).length===0)return e.jsxs("div",{className:"bg-white border rounded p-4 text-sm text-gray-400",children:[s,": No attendance data"]});const d=["S","M","T","W","T","F","S"];return e.jsxs("div",{className:"bg-white border rounded p-4 space-y-6",children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-700",children:[s," Attendance"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(l.calendar).map(([n,t])=>{const r=l.year??new Date().getFullYear(),y=new Date(`${n} 1, ${r}`).getMonth(),x=new Date(r,y,1).getDay(),v=Object.keys(t).length;return e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("div",{className:"text-center font-semibold text-xs mb-1",children:n}),e.jsx("div",{className:"grid grid-cols-7 text-[10px] text-center text-gray-500 mb-1",children:d.map((o,m)=>e.jsx("div",{children:o},`${n}-day-${m}`))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-[10px]",children:[Array.from({length:x}).map((o,m)=>e.jsx("div",{className:"h-10"},`${n}-empty-${m}`)),Array.from({length:v},(o,m)=>{const i=m+1,h=t[i];let p="bg-gray-100 text-gray-400",u="—";return h?.status==="present"?(p="bg-green-100 text-green-700",u="P"):h?.status==="absent"?(p="bg-red-100 text-red-700",u="A"):h?.status==="leave"&&(p="bg-yellow-100 text-yellow-700",u="L"),e.jsxs("div",{className:`relative h-10 rounded ${p} flex items-center justify-center`,children:[e.jsx("div",{className:"absolute top-0.5 right-1 text-[9px] opacity-60",children:i}),e.jsx("div",{className:"font-semibold",children:u}),h?.lesson_learned&&e.jsx("div",{className:"absolute bottom-0.5 left-1 text-blue-700 font-bold",children:"✓"})]},`${n}-${i}`)})]})]},n)})}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-gray-600",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"P"})," = Present"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"A"})," = Absent"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"L"})," = Leave"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"✓"})," = Lesson Learned"]})]})]})}function D({studentOptions:s,yearOptions:l,monthOptions:d,studentId:n,year:t,monthFrom:r,monthTo:y,setStudentId:x,setYear:v,setMonthFrom:o,setMonthTo:m,loading:i,buildReport:h,exportPdf:p,report:u}){return e.jsx("div",{className:"bg-white p-4 rounded border mb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx(S,{options:s,value:n?[n]:[],placeholder:"Select student",onChange:g=>x(g[0]??null),single:!0}),e.jsx(S,{options:l,value:[t],placeholder:"Year",onChange:g=>{v(g[0]),o(null),m(null)},single:!0}),e.jsx(S,{options:d,value:r?[r]:[],placeholder:"From month (optional)",onChange:g=>o(g[0]??null),single:!0,disabled:!t}),e.jsx(S,{options:d,value:y?[y]:[],placeholder:"To month (optional)",onChange:g=>m(g[0]??null),single:!0,disabled:!t}),e.jsx("button",{onClick:h,disabled:!n||!t||i,className:"px-4 py-2 bg-blue-600 text-white rounded text-sm disabled:bg-gray-400",children:i?"Building…":"Build Report"}),e.jsx("button",{onClick:p,disabled:!u,className:`px-4 py-2 rounded text-sm border ${u?"bg-white hover:bg-gray-50 text-gray-800":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Export PDF"})]})})}function F({title:s,fees:l}){if(!l||!l.summary)return e.jsxs("div",{className:"bg-white border rounded p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700",children:[s," Fees"]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2",children:"No fee data available"})]});const{summary:d,rows:n}=l;return e.jsxs("div",{className:"bg-white border rounded p-4 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700",children:[s," Fees"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsx(f,{label:"Total",value:`Rs. ${d.total}`}),e.jsx(f,{label:"Paid",value:`Rs. ${d.paid}`}),e.jsx(f,{label:"Pending",value:`Rs. ${d.pending}`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-700 mb-2",children:"✔ Paid Fees"}),n.filter(t=>t.is_paid).length===0?e.jsx("div",{className:"text-gray-400",children:"No paid fees"}):e.jsx("ul",{className:"space-y-2",children:n.filter(t=>t.is_paid).map((t,r)=>e.jsxs("li",{className:"flex justify-between items-center border rounded px-3 py-2 bg-green-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.type==="monthly"?"Monthly Fee":t.title}),t.month&&e.jsx("div",{className:"text-xs text-gray-500",children:t.month})]}),e.jsxs("div",{className:"font-semibold",children:["Rs. ",t.amount]})]},`paid-${r}`))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-700 mb-2",children:"⏳ Unpaid Fees"}),n.filter(t=>!t.is_paid).length===0?e.jsx("div",{className:"text-gray-400",children:"No unpaid fees"}):e.jsx("ul",{className:"space-y-2",children:n.filter(t=>!t.is_paid).map((t,r)=>e.jsxs("li",{className:"flex justify-between items-center border rounded px-3 py-2 bg-red-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.type==="monthly"?"Monthly Fee":t.title}),t.month&&e.jsx("div",{className:"text-xs text-gray-500",children:t.month})]}),e.jsxs("div",{className:"font-semibold",children:["Rs. ",t.amount]})]},`unpaid-${r}`))})]})]})]})}export{E as StudentHeader,O as SummaryCards,G as default};
