import{u as I,r as n,j as s,a as o,z as v}from"./app-DTPqrqzE.js";import{A as P}from"./AdminLayout-BhXxqSww.js";import{u as $,f as b,g as L,b as Y}from"./index-Cy8aYFMb.js";import"./logo-CAn8f4K1.js";function V(){const{fees:f,filters:l}=I().props,N=f??[],[y,S]=n.useState([]),[_,C]=n.useState([]),[R,x]=n.useState([]),[w,m]=n.useState(l?.search??""),[c,A]=n.useState(null),u=2025,F=new Date().getFullYear(),E=Array.from({length:F-u+1},(e,a)=>u+a),U=[{label:"All",value:""},{label:"Paid",value:"paid"},{label:"Unpaid",value:"unpaid"}];n.useEffect(()=>{fetch("/admin/classes/options").then(e=>e.json()).then(C)},[]),n.useEffect(()=>{if(!l?.class_id){x([]);return}fetch(`/admin/sections/options?class_id=${l.class_id}`).then(e=>e.json()).then(x)},[l?.class_id]),n.useEffect(()=>{m(l?.search??"")},[l?.search]);function M(e){o.post(route("admin.fees.collect",e),{},{preserveScroll:!0,onSuccess:()=>v.success("Fee collected")})}function k(e){confirm("Un-collect this fee?")&&o.post(route("admin.fees.deCollect",e),{},{preserveScroll:!0,onSuccess:()=>v.success("Fee un-collected")})}function h(e){if(!e)return"";const a=new Date(`${e}-01`);return Number.isNaN(a.getTime())?e:a.toLocaleString("en-US",{month:"short",year:"numeric"})}const T=n.useMemo(()=>[{header:"#",cell:({row:e})=>e.index+1},{accessorKey:"student_name",header:"Student"},{accessorKey:"class_name",header:"Class"},{accessorKey:"section_name",header:"Section"},{header:"Unpaid",cell:({row:e})=>s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"font-medium text-red-600",children:["Rs ",e.original.unpaid_amount]}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.original.unpaid_count," fees"]})]})},{header:"Paid",cell:({row:e})=>s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"font-medium text-green-600",children:["Rs ",e.original.paid_amount]}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.original.paid_count," fees"]})]})},{header:"Total",cell:({row:e})=>`Rs ${e.original.total_amount}`},{header:"Details",cell:({row:e})=>{const r=e.original.unpaid_count??0,d=c===e.id;return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>A(d?null:e.id),className:"text-blue-600 text-sm",children:d?"Hide":"View"}),s.jsx("span",{className:"text-xs text-gray-500",children:r===0?"All paid":`${r} unpaid`})]})}}],[c]),p=$({data:N,columns:T,state:{sorting:y},onSortingChange:S,getCoreRowModel:Y(),getSortedRowModel:L()}),i=n.useCallback((e,a,r={})=>{o.get(route("admin.fees.index"),{...l,[e]:a,...e==="class_id"?{section_id:""}:{}},{preserveState:r.preserveState??!1,replace:!0})},[l]),D=n.useCallback(e=>{(l?.search??"")!==e&&i("search",e,{preserveState:!0})},[i,l?.search]);return s.jsxs(P,{title:"Fees",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:l?.year??"",onChange:e=>i("year",e.target.value),children:[s.jsx("option",{value:"",children:"Year: All"}),E.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:l?.class_id??"",onChange:e=>i("class_id",e.target.value),children:[s.jsx("option",{value:"",children:"Class: All"}),_.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border px-3 py-2 rounded text-sm",value:l?.section_id??"",disabled:!l?.class_id,onChange:e=>i("section_id",e.target.value),children:[s.jsx("option",{value:"",children:"Section: All"}),R.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:U.map(e=>{const a=(l?.status??"")===e.value;return s.jsx("button",{onClick:()=>i("status",e.value),className:`px-3 py-1 text-sm rounded-md transition
          ${a?"bg-white shadow text-blue-600 font-medium":"text-gray-600 hover:text-black"}`,children:e.label},e.value||"all")})}),s.jsx("input",{className:"border px-3 py-2 rounded text-sm w-64",placeholder:"Search student...",value:w,onChange:e=>{const a=e.target.value;m(a),D(a)}})]}),s.jsx("div",{className:"bg-white border rounded-lg overflow-x-auto",children:s.jsxs("table",{className:"min-w-[1000px] text-sm",children:[s.jsx("thead",{className:"bg-gray-50 border-b",children:p.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(a=>s.jsx("th",{className:"px-3 py-2 text-left",children:b(a.column.columnDef.header,a.getContext())},a.id))},e.id))}),s.jsx("tbody",{children:p.getRowModel().rows.map(e=>{const a=e.original,r=c===e.id,d=a.fees??[],g=d.filter(t=>!t.is_paid),j=d.filter(t=>t.is_paid);return s.jsxs(n.Fragment,{children:[s.jsx("tr",{className:"border-b",children:e.getVisibleCells().map(t=>s.jsx("td",{className:"px-3 py-2",children:b(t.column.columnDef.cell,t.getContext())},t.id))}),r&&s.jsx("tr",{className:"border-b bg-gray-50",children:s.jsx("td",{colSpan:8,className:"px-3 py-3",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Unpaid Fees"}),g.length===0?s.jsx("div",{className:"text-xs text-gray-500",children:"No unpaid fees."}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:g.map(t=>s.jsxs("div",{className:"flex items-center justify-between border rounded px-3 py-2 bg-white",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium",children:t.type==="monthly"?h(t.month):t.title}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Rs ",t.amount]})]}),s.jsx("button",{onClick:()=>M(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-xs",children:"Collect"})]},t.id))})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Paid Fees (Un-collect)"}),j.length===0?s.jsx("div",{className:"text-xs text-gray-500",children:"No paid fees."}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:j.map(t=>s.jsxs("div",{className:"flex items-center justify-between border rounded px-3 py-2 bg-white",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium",children:t.type==="monthly"?h(t.month):t.title}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Rs ",t.amount]})]}),s.jsx("button",{onClick:()=>k(t.id),className:"text-yellow-700 bg-yellow-100 hover:bg-yellow-200 px-3 py-1.5 rounded text-xs",children:"Un-collect"})]},t.id))})]})]})})})]},e.id)})})]})})]})}export{V as default};
