import{r as c,j as e}from"./app-d8hNY_vC.js";import{S}from"./SimpleLayout-DZwMzUbo.js";function _({dueThisMonth:r=[],dueOlder:n=[],totalPending:s=0}){const[l,m]=c.useState("all"),[o,a]=c.useState("all"),[d,h]=c.useState(""),p=c.useMemo(()=>[...r??[],...n??[]],[r,n]),v=c.useMemo(()=>Array.from(new Set(p.map(t=>x(t?.class)).filter(Boolean))).sort((t,i)=>t.localeCompare(i)),[p]),w=c.useMemo(()=>{const t=l==="all"?p:p.filter(i=>x(i?.class)===l);return Array.from(new Set(t.map(i=>x(i?.section)).filter(Boolean))).sort((i,C)=>i.localeCompare(C))},[p,l]),u=c.useMemo(()=>({classFilter:l,sectionFilter:o,search:d}),[l,o,d]),f=c.useMemo(()=>N(r,u),[r,u]),j=c.useMemo(()=>N(n,u),[n,u]),g=c.useMemo(()=>[...f,...j].reduce((t,i)=>t+Number(i?.amount??0),0),[f,j]);return e.jsx(S,{title:"Late Fees",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-xl border shadow-sm p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("select",{value:l,onChange:t=>{const i=t.target.value;m(i),a("all")},className:"border rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Classes"}),v.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:o,onChange:t=>a(t.target.value),className:"border rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Sections"}),w.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:d,onChange:t=>h(t.target.value),placeholder:"Search by student",className:"border rounded-lg px-3 py-2 text-sm"})]})}),e.jsx(y,{emoji:"[This Month]",title:"Due This Month",description:"Students whose monthly fee is pending for the current month",items:f}),e.jsx(y,{emoji:"[Older]",title:"Pending From Previous Months",description:"Fees pending from earlier months",items:j}),e.jsxs("div",{className:"bg-gray-50 border rounded-xl p-6 text-center",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Total Pending Amount"}),e.jsxs("p",{className:"text-3xl font-semibold text-gray-800 mt-2",children:["Rs. ",g]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:b(u)?"Combined unpaid monthly fees (filtered)":"Combined unpaid monthly fees"}),!b(u)&&Number(s)!==g?e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Overall total: Rs. ",s]}):null]})]})})}function y({emoji:r,title:n,description:s,items:l}){const m=F(l),o=Object.values(m);return e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-5",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-medium text-gray-800",children:[r," ",n]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s})]}),e.jsx("span",{className:"text-sm text-gray-600",children:o.length})]}),o.length===0?e.jsx("p",{className:"mt-4 text-sm text-gray-600 text-center",children:"No pending fees"}):e.jsx("div",{className:"mt-4 space-y-4",children:o.map(a=>e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-gray-800",children:a.student}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.class," - ",a.section]})]}),e.jsx("button",{onClick:()=>window.location.href=`/accountant/receive-fee?student_id=${a.student_id}`,className:"bg-green-600 text-white px-4 py-2 rounded-lg text-sm whitespace-nowrap",children:"Collect Fee"})]}),e.jsx("ul",{className:"space-y-1 text-sm",children:M(a.fees).map((d,h)=>e.jsxs("li",{className:"flex justify-between text-gray-600",children:[e.jsxs("span",{children:["- ",d.month]}),e.jsxs("span",{children:["Rs. ",d.amount]})]},h))})]},`${a.student_id}-${a.section}`))})]})}function x(r){return String(r??"").trim()}function b({classFilter:r,sectionFilter:n,search:s}){return r!=="all"||n!=="all"||String(s??"").trim()!==""}function N(r,{classFilter:n,sectionFilter:s,search:l}){const m=String(l??"").trim().toLowerCase();return(r??[]).filter(o=>{const a=x(o?.class),d=x(o?.section),h=x(o?.student).toLowerCase();return n!=="all"&&a!==n||s!=="all"&&d!==s?!1:m===""?!0:h.includes(m)||a.toLowerCase().includes(m)||d.toLowerCase().includes(m)})}function F(r){return r.reduce((n,s)=>{const l=`${s.student_id}-${s.section}`;return n[l]||(n[l]={student_id:s.student_id,student:s.student,class:s.class,section:s.section,fees:[]}),n[l].fees.push({month:s.month,amount:s.amount}),n},{})}function M(r){return Object.values(r.reduce((n,s)=>(n[s.month]=s,n),{}))}export{_ as default};
