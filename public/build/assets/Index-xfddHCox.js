import{r as o,j as s,a as f,z as a}from"./app-DJfHBbO4.js";import{A as D}from"./AdminLayout-Z3678DNH.js";import{u as M,f as b,g as E,a as I,b as k}from"./index-BtBcHxdd.js";function G(){const[d,l]=o.useState([]),[u,j]=o.useState([]),[S,C]=o.useState([]),[m,x]=o.useState(""),g=o.useRef(null);o.useEffect(()=>{r(),fetch("/admin/classes/options").then(e=>e.json()).then(j)},[]);function r(){fetch("/admin/sections/data").then(e=>e.json()).then(l)}function p(e,t,i){l(c=>c.map((n,F)=>F===e?{...n,[t]:i}:n))}function w({row:e,column:t,autoFocus:i=!1}){const c=i?g:null;return s.jsx("input",{ref:c,defaultValue:e.original[t.id]??"",className:"w-full px-2 py-1 border rounded text-sm",onBlur:n=>p(e.index,t.id,n.target.value),onKeyDown:n=>{n.key==="Enter"&&n.currentTarget.blur()}})}function y({row:e}){return s.jsxs("select",{value:e.original.class_id??"",className:"w-full px-2 py-1 border rounded text-sm",onChange:t=>p(e.index,"class_id",t.target.value),children:[s.jsx("option",{value:"",children:"Select class"}),u.map(t=>s.jsx("option",{value:t.id,children:t.name},t.id))]})}const v=o.useMemo(()=>[{accessorKey:"name",header:"Section Name",cell:({row:e,column:t})=>s.jsx(w,{row:e,column:t,autoFocus:e.original.__isNew})},{accessorKey:"class_id",header:"Class",cell:({row:e})=>s.jsx(y,{row:e})},{accessorKey:"students_count",header:"Students",cell:({row:e})=>s.jsx("span",{className:"text-gray-600 text-sm",children:e.original.students_count??0})},{header:"Action",cell:({row:e})=>s.jsx("button",{onClick:()=>R(e.original.id),className:"text-red-600 text-sm hover:underline",children:"Delete"})}],[u]),h=M({data:d,columns:v,getRowId:e=>e.id?`section-${e.id}`:e.__tempId,state:{sorting:S,globalFilter:m},onSortingChange:C,onGlobalFilterChange:x,getCoreRowModel:k(),getFilteredRowModel:I(),getSortedRowModel:E(),globalFilterFn:"includesString"});function N(){f.post("/admin/sections/save",{sections:d},{onSuccess:()=>{a.success("Sections saved"),r()},onError:()=>a.error("Save failed")})}function R(e){confirm("Delete this section? This cannot be undone.")&&f.delete(`/admin/sections/${e}`,{onSuccess:()=>{a.success("Section deleted"),r()},onError:t=>{a.error(t?.response?.data?.message||"Cannot delete section")}})}function _(){const e={id:null,__tempId:crypto.randomUUID(),name:"",class_id:"",__isNew:!0};l(t=>[e,...t]),requestAnimationFrame(()=>{g.current?.focus()})}return s.jsxs(D,{title:"Sections",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-between mb-4",children:[s.jsx("input",{className:"px-3 py-2 border rounded text-sm w-full sm:w-64",placeholder:"Search sections…",value:m,onChange:e=>x(e.target.value)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded text-sm",children:"+ Add Section"}),s.jsx("button",{onClick:N,className:"px-4 py-2 bg-green-600 text-white rounded text-sm",children:"Save Changes"})]})]}),s.jsx("div",{className:"bg-white border rounded-lg overflow-auto max-h-[70vh]",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50 border-b sticky top-0",children:h.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(t=>s.jsxs("th",{className:"px-3 py-2 text-left font-medium cursor-pointer",onClick:t.column.getToggleSortingHandler(),children:[b(t.column.columnDef.header,t.getContext()),t.column.getIsSorted()==="asc"&&" ↑",t.column.getIsSorted()==="desc"&&" ↓"]},t.id))},e.id))}),s.jsx("tbody",{children:h.getRowModel().rows.map(e=>s.jsx("tr",{className:"border-b hover:bg-gray-50",children:e.getVisibleCells().map(t=>s.jsx("td",{className:"px-3 py-2",children:b(t.column.columnDef.cell,t.getContext())},t.id))},e.id))})]})})]})}export{G as default};
