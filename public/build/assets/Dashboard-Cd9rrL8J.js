import{r as i,j as e}from"./app-CKCcpFSt.js";import{A as S}from"./AdminLayout-DVIreQcb.js";import{f as h}from"./helper-BxvJq_M8.js";function t(n){const d=Number(n);return Number.isFinite(d)?d:0}function r({label:n,value:d,sub:o,accent:c="bg-slate-700"}){return e.jsxs("div",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:n}),e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${c}`})]}),e.jsx("p",{className:"text-xl font-semibold text-slate-800",children:d}),o?e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:o}):null]})}function y({label:n,value:d,total:o,tone:c="bg-blue-600",suffix:u=""}){const l=t(d),p=t(o),m=p>0?Math.max(0,Math.min(100,Math.round(l/p*100))):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-slate-600",children:n}),e.jsxs("span",{className:"font-medium text-slate-800",children:[d,u]})]}),e.jsx("div",{className:"h-2 rounded-full bg-slate-100 overflow-hidden",children:e.jsx("div",{className:`h-full ${c}`,style:{width:`${m}%`}})})]})}function F(){const n=new Date().getFullYear(),[d,o]=i.useState(String(n)),[c,u]=i.useState(!0),[l,p]=i.useState(null),[m,f]=i.useState(""),[j,g]=i.useState("gurmukhi"),[x,v]=i.useState("all");i.useEffect(()=>{u(!0),f(""),fetch(`/admin/dashboard/summary?year=${d}`).then(async s=>{if(!s.ok)throw new Error("Failed to load dashboard summary");return s.json()}).then(s=>{p(s),(s?.divisions??[]).some(w=>w.type===j)||g(s?.divisions?.[0]?.type??"gurmukhi")}).catch(s=>{f(s.message||"Unable to load dashboard data")}).finally(()=>u(!1))},[d]);const a=i.useMemo(()=>(l?.divisions??[]).find(s=>s.type===j)??null,[l,j]),b=i.useMemo(()=>!a||x==="all"?null:a.classes.find(s=>String(s.id)===String(x))??null,[a,x]),N=b?b.sections:[];return e.jsx(S,{title:"Dashboard",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white border rounded-xl px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-800",children:"School Admin Dashboard"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Fees, attendance and division performance in one operational view."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs uppercase text-slate-500",children:"Year"}),e.jsx("select",{value:d,onChange:s=>o(s.target.value),className:"border rounded-md px-2 py-1.5 text-sm",children:[n-2,n-1,n,n+1].map(s=>e.jsx("option",{value:String(s),children:s},s))})]})]})}),c?e.jsx("div",{className:"bg-white border rounded-xl p-6 text-sm text-slate-500",children:"Loading dashboard..."}):null,!c&&m?e.jsx("div",{className:"bg-white border rounded-xl p-6 text-sm text-rose-600",children:m}):null,!c&&!m&&l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-3",children:[e.jsx(r,{label:"Total Fees",value:h(t(l.fees.total)),accent:"bg-blue-600"}),e.jsx(r,{label:"Collected",value:h(t(l.fees.collected)),accent:"bg-emerald-600"}),e.jsx(r,{label:"Pending",value:h(t(l.fees.pending)),accent:"bg-rose-600"}),e.jsx(r,{label:"Collection Rate",value:`${t(l.fees.percentage)}%`,sub:"Collected / Total",accent:"bg-violet-600"}),e.jsx(r,{label:"Active Students",value:t(l.students.active),sub:`${t(l.students.total)} total students`,accent:"bg-amber-500"})]}),e.jsxs("div",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("div",{className:"inline-flex border rounded-lg p-1 bg-slate-50",children:(l.divisions??[]).map(s=>e.jsx("button",{onClick:()=>{g(s.type),v("all")},className:`px-3 py-1.5 rounded-md text-sm border ${j===s.type?"bg-emerald-600 border-emerald-600 text-white":"bg-white border-slate-200 text-slate-700 hover:bg-slate-100"}`,children:s.title},s.type))}),a?e.jsxs("select",{value:x,onChange:s=>v(s.target.value),className:"border rounded-md px-2 py-1.5 text-sm",children:[e.jsxs("option",{value:"all",children:["All Classes (",a.title,")"]}),a.classes.map(s=>e.jsx("option",{value:String(s.id),children:s.name},s.id))]}):null]}),a?e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"xl:col-span-1 border rounded-lg p-3 bg-slate-50/60",children:[e.jsxs("p",{className:"text-xs uppercase text-slate-500 mb-3",children:[a.title," Overview"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{label:"Division Fee Collection",value:t(a.fees.collected),total:Math.max(1,t(a.fees.total)),tone:"bg-emerald-600",suffix:""}),e.jsx(y,{label:"Division Attendance (Present %)",value:t(a.attendance.percentage),total:100,tone:"bg-blue-600",suffix:"%"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-1",children:[e.jsx(r,{label:"Classes",value:t(a.stats.classes_count),accent:"bg-slate-600"}),e.jsx(r,{label:"Sections",value:t(a.stats.sections_count),accent:"bg-slate-600"}),e.jsx(r,{label:"Students",value:t(a.stats.students_count),accent:"bg-amber-500"}),e.jsx(r,{label:"Active",value:t(a.stats.active_students_count),accent:"bg-emerald-600"})]})]})]}),e.jsxs("div",{className:"xl:col-span-2 space-y-4",children:[e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 bg-slate-50 border-b text-sm font-medium text-slate-700",children:"Class Performance"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white border-b text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Class"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Students"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Fees"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Collection %"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Attendance %"})]})}),e.jsx("tbody",{children:a.classes.filter(s=>x==="all"||String(s.id)===String(x)).map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2 font-medium text-slate-800",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:t(s.students_count)}),e.jsx("td",{className:"px-3 py-2",children:h(t(s.fees.total))}),e.jsxs("td",{className:"px-3 py-2",children:[t(s.fees.percentage),"%"]}),e.jsxs("td",{className:"px-3 py-2",children:[t(s.attendance.percentage),"%"]})]},s.id))})]})})]}),x!=="all"?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 bg-slate-50 border-b text-sm font-medium text-slate-700",children:["Section Summary ",b?`- ${b.name}`:""]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white border-b text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Section"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Students"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Fees"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Collection %"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Attendance %"})]})}),e.jsxs("tbody",{children:[N.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2 font-medium text-slate-800",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:t(s.students_count)}),e.jsx("td",{className:"px-3 py-2",children:h(t(s.fees.total))}),e.jsxs("td",{className:"px-3 py-2",children:[t(s.fees.percentage),"%"]}),e.jsxs("td",{className:"px-3 py-2",children:[t(s.attendance.percentage),"%"]})]},s.id)),N.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-4 text-slate-400",colSpan:5,children:"No sections found for this class."})}):null]})]})})]}):e.jsx("div",{className:"border rounded-lg p-3 bg-slate-50 text-sm text-slate-500",children:"Select a class to view section-level summaries."})]})]}):e.jsx("div",{className:"text-sm text-slate-500",children:"No division data found."})]}),e.jsxs("div",{className:"text-xs text-right text-slate-400",children:["Last updated: ",l.meta.generated_at]})]}):null]})})}export{F as default};
