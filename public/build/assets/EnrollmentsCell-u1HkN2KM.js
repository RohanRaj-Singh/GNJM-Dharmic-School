import{r as f,j as i}from"./app-DJfHBbO4.js";function v({row:o,classes:c,sectionsByClass:g,loadSections:m,setData:u,setIsDirty:x}){const a=o.original.enrollments??[];f.useEffect(()=>{a.forEach(n=>{n.class_id&&m(n.class_id)})},[a,m]);const h=f.useMemo(()=>a.map(n=>String(n.class_id)).filter(Boolean),[a]);function p(n,t,s){u(l=>l.map((d,e)=>e!==o.index?d:{...d,enrollments:d.enrollments.map(r=>r.id===n?{...r,[t]:s}:r)})),x(!0)}function _(){u(n=>n.map((t,s)=>s!==o.index?t:{...t,enrollments:[...a,{id:crypto.randomUUID(),class_id:"",section_id:""}]})),x(!0)}function b(n){u(t=>t.map((s,l)=>l!==o.index?s:{...s,enrollments:s.enrollments.filter(d=>d.id!==n)})),x(!0)}return i.jsxs("div",{className:"flex flex-col gap-2 min-w-[260px]",children:[a.map(n=>{const t=c.length>0,s=c.filter(e=>!h.includes(String(e.id))||String(e.id)===String(n.class_id)),l=!!n.class_id&&Array.isArray(g[String(n.class_id)]),d=g[String(n.class_id)]||[];return i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsxs("select",{disabled:!t,value:t?String(n.class_id??""):"",onChange:e=>{const r=e.target.value;p(n.id,"class_id",r),p(n.id,"section_id",""),m(r)},className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:t?"Class":"Loading…"}),s.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]},`class-${n.id}-${c.length}`),i.jsxs("select",{disabled:!l,value:l?String(n.section_id??""):"",onChange:e=>p(n.id,"section_id",e.target.value),className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:l?"Section":"Loading…"}),d.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]},`section-${n.id}-${l?"ready":"wait"}`),i.jsx("button",{type:"button",onClick:()=>b(n.id),className:"text-red-600 text-sm",children:"✕"})]},n.id)}),i.jsx("button",{type:"button",onClick:_,className:"text-blue-600 text-xs self-start mt-1",children:"+ Add Enrollment"})]})}export{v as default};
