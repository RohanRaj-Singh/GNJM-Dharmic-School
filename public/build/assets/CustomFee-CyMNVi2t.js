import{u as A,r as l,j as t,a as r,z as o}from"./app-BA81Vu_y.js";import{A as R}from"./AdminLayout-DOabCgsH.js";import{u as F,f as x,g as M,b as k}from"./index-OA3rWZjz.js";import"./logo-CAn8f4K1.js";function B(){const{rows:p,sections:g}=A().props,[d,h]=l.useState(p??[]),[f,b]=l.useState({}),[j,i]=l.useState(!1),[a,n]=l.useState({section_id:"",title:"",amount:""});function c(e,s,v){h(S=>S.map((m,w)=>w===e?{...m,[s]:v,__dirty:!0}:m))}function y(e){r.put(route("admin.fees.custom.update"),{section_id:e.section_id,old_title:e.title,old_amount:e.amount,title:e.title,amount:e.amount},{preserveScroll:!0,onSuccess:()=>o.success("Custom fee updated")})}function N(e){confirm("Delete this custom fee for entire section?")&&r.delete(route("admin.fees.custom.destroy.section"),{data:{section_id:e.section_id,title:e.title,amount:e.amount},preserveScroll:!0,onSuccess:()=>o.success("Custom fee deleted")})}function C(){if(!a.section_id||!a.title||!a.amount){o.error("All fields are required");return}r.post(route("admin.fees.custom.store"),a,{preserveScroll:!0,onSuccess:()=>{o.success("Custom fee assigned"),i(!1),n({section_id:"",title:"",amount:""})}})}const _=l.useMemo(()=>[{header:"#",cell:({row:e})=>e.index+1},{accessorKey:"class_name",header:"Class"},{accessorKey:"section_name",header:"Section"},{accessorKey:"title",header:"Title",cell:({row:e})=>t.jsx("input",{defaultValue:e.original.title,disabled:e.original.paid_count>0,className:"border px-2 py-1 rounded text-sm w-full",onBlur:s=>c(e.index,"title",s.target.value)})},{accessorKey:"amount",header:"Amount",cell:({row:e})=>t.jsx("input",{type:"number",min:1,defaultValue:e.original.amount,disabled:e.original.paid_count>0,className:"border px-2 py-1 rounded text-sm w-full",onBlur:s=>c(e.index,"amount",Number(s.target.value))})},{header:"Students",cell:({row:e})=>e.original.total_students},{header:"Paid",cell:({row:e})=>e.original.paid_count>0?t.jsx("span",{className:"text-green-600",children:e.original.paid_count}):t.jsx("span",{className:"text-gray-400",children:"0"})},{header:"Actions",cell:({row:e})=>{const s=e.original;return s.paid_count>0?t.jsx("span",{className:"text-gray-400 text-sm",children:"Locked"}):t.jsxs("div",{className:"flex gap-2",children:[s.__dirty&&t.jsx("button",{onClick:()=>y(s),className:"text-green-600 text-sm",children:"Save"}),t.jsx("button",{onClick:()=>N(s),className:"text-red-600 text-sm",children:"Delete"})]})}}],[d]),u=F({data:d,columns:_,state:{sorting:f},onSortingChange:b,getCoreRowModel:k(),getSortedRowModel:M()});return t.jsxs(R,{title:"Custom Fees",children:[t.jsx("div",{className:"flex justify-end mb-4",children:t.jsx("button",{onClick:()=>i(!0),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"+ Assign Custom Fee"})}),t.jsx("div",{className:"bg-white border rounded-lg overflow-x-auto",children:t.jsxs("table",{className:"min-w-[900px] text-sm",children:[t.jsx("thead",{className:"bg-gray-50 border-b",children:u.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(s=>t.jsx("th",{className:"px-3 py-2 text-left",children:x(s.column.columnDef.header,s.getContext())},s.id))},e.id))}),t.jsx("tbody",{children:u.getRowModel().rows.map(e=>t.jsx("tr",{className:"border-b",children:e.getVisibleCells().map(s=>t.jsx("td",{className:"px-3 py-2",children:x(s.column.columnDef.cell,s.getContext())},s.id))},e.id))})]})}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-5",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Custom Fee"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:a.section_id,onChange:e=>n({...a,section_id:e.target.value}),children:[t.jsx("option",{value:"",children:"Select Section"}),g.map(e=>t.jsxs("option",{value:e.id,children:[e.class_name," â€” ",e.name]},e.id))]}),t.jsx("input",{className:"w-full border px-3 py-2 rounded",placeholder:"Fee title",value:a.title,onChange:e=>n({...a,title:e.target.value})}),t.jsx("input",{type:"number",className:"w-full border px-3 py-2 rounded",placeholder:"Amount",value:a.amount,onChange:e=>n({...a,amount:e.target.value})})]}),t.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[t.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-sm",children:"Cancel"}),t.jsx("button",{onClick:C,className:"bg-green-600 text-white px-4 py-2 rounded text-sm",children:"Assign"})]})]})})]})}export{B as default};
