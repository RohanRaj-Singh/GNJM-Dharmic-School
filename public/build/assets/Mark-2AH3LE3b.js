import{r as i,j as a,a as h}from"./app-D3ivcfqa.js";import{S as w}from"./SimpleLayout-pF_nuUUP.js";import T from"./AttendanceMarkPage-DJbll3hF.js";import C from"./AttendanceSummaryPage-HE4wEsdO.js";function E({section:r,hasAttendanceToday:d,existingAttendance:_=[]}){const m=(t=>{const o=String(t?.type??"").trim().toLowerCase(),s=String(t?.name??"").trim().toLowerCase(),e=`${o} ${s}`.trim();return e.includes("kirtan")?"kirtan":e.includes("gurmukhi")?"gurmukhi":""})(r.school_class)==="kirtan",u=new Date,f=u.toLocaleDateString(void 0,{weekday:"long"}),y=u.toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"}),g=t=>({student_id:t.student_section?.student?.id,name:t.student_section?.student?.name??"Unknown",father_name:t.student_section?.student?.father_name??null,status:t.status??"present",lesson_learned:!!t.lesson_learned}),k=t=>({student_id:t.student.id,name:t.student.name,father_name:t.student.father_name??null,status:"present",lesson_learned:!1}),c=t=>t.status==="absent"||t.status==="leave"?{...t,lesson_learned:!1}:t,[n,l]=i.useState(()=>d?_.map(g).filter(t=>t.student_id):r.student_sections.map(k)),[p,S]=i.useState(d?"summary":"mark"),[x,j]=i.useState(0),L=t=>{l(o=>o.map((s,e)=>e===x?{...s,...c(t)}:s))},b=(t,o)=>{l(s=>s.map(e=>e.student_id===t?{...e,...c(o)}:e))},v=()=>{h.post("/attendance",{section_id:r.id,attendance:n},{onSuccess:()=>{h.visit("/attendance/sections")}})};return a.jsxs(w,{title:"Mark Attendance",children:[a.jsxs("h2",{className:"font-semibold text-gray-800 mb-2 text-center",children:[r.school_class.name," - ",r.name]}),a.jsxs("p",{className:"text-center text-xs text-gray-500 mb-4",children:[f,", ",y]}),n.length===0&&a.jsx("p",{className:"text-center text-gray-500",children:"No students found in this section"}),p==="mark"&&n.length>0&&a.jsx(T,{records:n,index:x,setIndex:j,isKirtan:m,updateCurrent:L,onFinish:()=>S("summary")}),p==="summary"&&n.length>0&&a.jsx(C,{records:n,isKirtan:m,updateRecord:b,onSave:v})]})}export{E as default};
