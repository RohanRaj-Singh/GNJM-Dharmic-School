import{r as n,j as t,z as w}from"./app-DJfHBbO4.js";import{A as F}from"./AdminLayout-Z3678DNH.js";function O({classes:x=[]}){const b=new Date,[d,k]=n.useState(x.length?x[0].id:""),[a,h]=n.useState(""),[v,p]=n.useState([]),[c,C]=n.useState(b.getFullYear()),[l,A]=n.useState(String(b.getMonth()+1).padStart(2,"0")),[i,u]=n.useState(null),[g,S]=n.useState({}),[N,m]=n.useState(!1);n.useEffect(()=>{if(!d){p([]),h(""),u(null);return}fetch(`/admin/sections/options?class_id=${d}`).then(e=>{if(!e.ok)throw new Error("Failed to load sections");return e.json()}).then(e=>{p(e),h(e.length?String(e[0].id):"")}).catch(()=>{p([]),h("")})},[d]),n.useEffect(()=>{if(!a){u(null);return}m(!0),fetch(`/admin/attendance/grid?section_id=${a}&year=${c}&month=${parseInt(l)}`).then(e=>e.json()).then(u).finally(()=>m(!1))},[a,c,l]);function I(e,s,r){if(!r)return;const o=`${e}-${s}`,f=g[o]??i?.students?.find(j=>j.id===e)?.records?.[o]?.status??null,z=f===null?"present":f==="present"?"absent":f==="absent"?"leave":null;S(j=>({...j,[o]:z}))}function E(){m(!0),fetch("/admin/attendance/save",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({section_id:a,year:c,month:parseInt(l),records:g})}).then(e=>{if(!e.ok)throw new Error;return e.json()}).then(()=>{S({}),w.success("Attendance saved"),fetch(`/admin/attendance/grid?section_id=${a}&year=${c}&month=${parseInt(l)}`).then(e=>e.json()).then(u)}).catch(()=>{w.error("Failed to save attendance")}).finally(()=>m(!1))}const y=i?.days??[],$=i?.students??[];return t.jsxs(F,{title:"Attendance",children:[t.jsxs("div",{className:"flex flex-wrap gap-3 mb-4 items-center",children:[t.jsx("select",{value:d,onChange:e=>k(e.target.value),className:"border px-3 py-2 rounded text-sm",children:x.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),t.jsx("select",{value:a,onChange:e=>h(e.target.value),className:"border px-3 py-2 rounded text-sm",disabled:!v.length,children:v.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),t.jsx("input",{type:"month",value:`${c}-${l}`,onChange:e=>{const[s,r]=e.target.value.split("-");C(parseInt(s)),A(r)},className:"border px-3 py-2 rounded text-sm"}),i&&t.jsx("button",{onClick:E,className:"ml-auto px-4 py-2 bg-green-600 text-white rounded text-sm",children:"Save Attendance"})]}),t.jsxs("div",{className:"relative bg-white border rounded overflow-x-auto",children:[(!i||N)&&t.jsx("div",{className:"absolute inset-0 bg-white/70 flex items-center justify-center z-30",children:t.jsx("p",{className:"text-sm text-gray-500",children:N?"Loading attendance...":"Attendance will appear here"})}),t.jsxs("table",{className:"min-w-max text-sm border-collapse",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-20",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 sticky left-0 bg-gray-50 z-30 text-left",children:"Student"}),y.map(e=>t.jsx("th",{className:`px-2 py-2 text-center ${e.enabled?"":"text-gray-300"}`,children:e.day},e.date))]})}),t.jsxs("tbody",{children:[$.map(e=>t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"px-3 py-2 sticky left-0 bg-white z-10 font-medium",children:e.name}),y.map(s=>{const r=`${e.id}-${s.date}`,o=g[r]??e.records?.[r]?.status??null;return t.jsx("td",{onClick:()=>I(e.id,s.date,s.enabled),className:`px-2 py-2 text-center select-none
                        ${s.enabled?"cursor-pointer hover:bg-gray-100":"bg-gray-100 text-gray-300"}`,children:o?o[0].toUpperCase():"â€”"},s.date)})]},e.id)),!$.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:y.length+1,className:"px-4 py-6 text-center text-gray-500",children:"No students found in this section"})})]})]})]})]})}export{O as default};
