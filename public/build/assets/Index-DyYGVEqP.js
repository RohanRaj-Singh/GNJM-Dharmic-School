import{r as t,j as s,a as p}from"./app-CQFX0d8W.js";import{A as g}from"./AdminLayout-CiF9MnJt.js";import{u as k,f as j,b as M}from"./index-QZ9rAdie.js";import{M as R}from"./MultiSelect-D2y4Nu7c.js";function P(){const[c,o]=t.useState([]),[d,v]=t.useState([]),[b,f]=t.useState(!0),[u,y]=t.useState(null),[l,i]=t.useState({name:"",username:"",role:"teacher",sections:[]});t.useEffect(()=>{Promise.all([fetch("/admin/users/data").then(e=>e.json()),fetch("/admin/sections/with-classes").then(e=>e.json())]).then(([e,a])=>{o(e),v(a),f(!1)})},[]);function r(e,a,n){o(S=>S.map((h,A)=>A===e?{...h,[a]:n}:h))}function N(){o(e=>[...e,{name:"",username:"",role:"teacher",is_active:!0,sections:[]}])}function C(){p.post("/admin/users/save",{users:c},{onSuccess:()=>{fetch("/admin/users/data").then(e=>e.json()).then(o)}})}const m=t.useMemo(()=>d.flatMap(e=>e.sections.map(a=>({value:a.id,label:a.label}))),[d]),w=t.useMemo(()=>[{header:"#",cell:({row:e})=>e.index+1},{accessorKey:"name",header:"Name",cell:({row:e,column:a})=>s.jsx("input",{value:e.original.name,onChange:n=>r(e.index,a.id,n.target.value),className:"border px-2 py-1 rounded text-sm w-full"})},{accessorKey:"username",header:"Username",cell:({row:e,column:a})=>s.jsx("input",{value:e.original.username,onChange:n=>r(e.index,a.id,n.target.value),className:"border px-2 py-1 rounded text-sm w-full"})},{accessorKey:"role",header:"Role",cell:({row:e})=>s.jsxs("select",{value:e.original.role,onChange:a=>r(e.index,"role",a.target.value),className:"border px-2 py-1 rounded text-sm",children:[s.jsx("option",{value:"admin",children:"Admin"}),s.jsx("option",{value:"accountant",children:"Accountant"}),s.jsx("option",{value:"teacher",children:"Teacher"})]})},{accessorKey:"is_active",header:"Active",cell:({row:e})=>s.jsx("input",{type:"checkbox",checked:!!e.original.is_active,onChange:a=>r(e.index,"is_active",a.target.checked)})},{header:"Sections",cell:({row:e})=>e.original.role==="teacher"?s.jsx(R,{options:m,value:e.original.sections||[],onChange:a=>r(e.index,"sections",a),placeholder:"Select sections"}):s.jsx("span",{className:"text-gray-400 text-xs",children:"â€”"})},{header:"Password",cell:({row:e})=>{const a=u===e.original.id;return s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("input",{type:a?"text":"password",value:e.original.password||"",onChange:n=>r(e.index,"password",n.target.value),className:"border px-2 py-1 rounded text-xs w-36",placeholder:"New password"}),s.jsx("button",{type:"button",onClick:()=>y(a?null:e.original.id),className:"text-gray-500 hover:text-black text-sm",children:a?"ðŸ™ˆ":"ðŸ‘"})]})}},{header:"Actions",cell:({row:e})=>s.jsx("button",{onClick:()=>{confirm("Delete this user?")&&p.delete(`/admin/users/${e.original.id}`)},className:"text-red-600 text-sm",children:"Delete"})}],[m,u]),x=k({data:c,columns:w,getCoreRowModel:M()});return b?s.jsx(g,{title:"Users",children:"Loadingâ€¦"}):s.jsxs(g,{title:"Users",children:[s.jsxs("div",{className:"mb-4 flex gap-2 items-end",children:[s.jsx("input",{placeholder:"Name",value:l.name,onChange:e=>i({...l,name:e.target.value}),className:"border px-2 py-1 rounded"}),s.jsx("input",{placeholder:"Username",value:l.username,onChange:e=>i({...l,username:e.target.value}),className:"border px-2 py-1 rounded"}),s.jsxs("select",{value:l.role,onChange:e=>i({...l,role:e.target.value}),className:"border px-2 py-1 rounded",children:[s.jsx("option",{value:"admin",children:"Admin"}),s.jsx("option",{value:"accountant",children:"Accountant"}),s.jsx("option",{value:"teacher",children:"Teacher"})]}),s.jsx("button",{onClick:N,className:"bg-blue-600 text-white px-3 py-1 rounded",children:"Add User"})]}),s.jsx("button",{onClick:C,className:"mb-3 bg-green-600 text-white px-4 py-2 rounded",children:"Save Changes"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full bg-white border text-sm",children:[s.jsx("thead",{children:x.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(a=>s.jsx("th",{className:"px-3 py-2 border-b text-left",children:j(a.column.columnDef.header,a.getContext())},a.id))},e.id))}),s.jsx("tbody",{children:x.getRowModel().rows.map(e=>s.jsx("tr",{children:e.getVisibleCells().map(a=>s.jsx("td",{className:"px-3 py-2 border-b align-top min-w-[150px]",children:j(a.column.columnDef.cell,a.getContext())},a.id))},e.id))})]})})]})}export{P as default};
