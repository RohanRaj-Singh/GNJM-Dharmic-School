import{r as m,j as o,a as x}from"./app-DJfHBbO4.js";import{S as E}from"./SimpleLayout-nCTIb97u.js";import N from"./AttendanceMarkPage-CXksJE4O.js";import v from"./AttendanceSummaryPage-Bh62VbS7.js";import"./AttendanceStudentCard-gtU8a64Z.js";import"./AttendanceRecordCard-evwZXabR.js";function z({section:t,hasAttendanceToday:d,existingAttendance:_=[]}){const u=t.school_class.name.toLowerCase()==="kirtan",f=e=>({student_id:e.student_id,name:e.name,status:e.status,lesson_learned:!!e.lesson_learned}),i=e=>e.status==="absent"||e.status==="leave"?{...e,lesson_learned:!1}:e,[a,c]=m.useState(()=>d?_.map(f):t.student_sections.map(e=>({student_id:e.student.id,name:e.student.name,status:"present",lesson_learned:!1}))),[l,S]=m.useState(d?"summary":"mark"),[p,j]=m.useState(0),k=e=>{c(r=>r.map((n,s)=>s===p?{...n,...i(e)}:n))},y=(e,r)=>{c(n=>n.map(s=>s.student_id===e?{...s,...i(r)}:s))},A=()=>{console.log("SENDING ATTENDANCE",a),x.post("/attendance",{section_id:t.id,attendance:a},{onSuccess:()=>{x.visit("/attendance/sections")}})};return o.jsxs(E,{title:"Mark Attendance",children:[o.jsxs("h2",{className:"font-semibold text-gray-800 mb-4 text-center",children:[t.school_class.name," Â· ",t.name]}),l==="mark"&&o.jsx(N,{records:a,index:p,setIndex:j,isKirtan:u,updateCurrent:k,onFinish:()=>S("summary")}),l==="summary"&&o.jsx(v,{records:a,isKirtan:u,updateRecord:y,onSave:A})]})}export{z as default};
