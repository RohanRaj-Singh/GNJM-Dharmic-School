import{r as h,j as n}from"./app-CKCcpFSt.js";function S({row:c,classes:x,sectionsByClass:_,loadSections:m,setData:p,setIsDirty:u}){const a=c.original.enrollments??[],g=c.original.id??c.original.__tempId;h.useEffect(()=>{a.forEach(e=>{e.class_id&&m(e.class_id)})},[a,m]);const b=h.useMemo(()=>a.map(e=>String(e.class_id)).filter(Boolean),[a]);function o(e,s,i){p(l=>l.map(d=>(d.id??d.__tempId)!==g?d:{...d,enrollments:d.enrollments.map(r=>String(r.id)===String(e)?{...r,[s]:i}:r)})),u(!0)}function j(){p(e=>e.map(s=>(s.id??s.__tempId)!==g?s:{...s,enrollments:[...a,{id:crypto.randomUUID(),class_id:"",section_id:"",student_type:"paid"}]})),u(!0)}function y(e){p(s=>s.map(i=>(i.id??i.__tempId)!==g?i:{...i,enrollments:i.enrollments.filter(l=>l.id!==e)})),u(!0)}return n.jsxs("div",{className:"flex flex-col gap-2 min-w-[320px]",children:[a.map(e=>{const s=x.length>0,i=x.filter(t=>!b.includes(String(t.id))||String(t.id)===String(e.class_id)),l=!!e.class_id&&Array.isArray(_[String(e.class_id)]),d=_[String(e.class_id)]||[],r=e.student_type==="free";return n.jsxs("div",{className:`flex gap-2 items-center p-2 rounded border
              ${r?"bg-green-50 border-green-200":"bg-white"}
            `,children:[n.jsxs("select",{disabled:!s,value:s?String(e.class_id??""):"",onChange:t=>{const f=t.target.value;o(e.id,"class_id",f),o(e.id,"section_id",""),m(f)},className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[n.jsx("option",{value:"",children:s?"Class":"Loading…"}),i.map(t=>n.jsx("option",{value:String(t.id),children:t.name},t.id))]}),n.jsxs("select",{disabled:!l,value:l?String(e.section_id??""):"",onChange:t=>o(e.id,"section_id",t.target.value),className:"border px-2 py-1 rounded text-sm disabled:bg-gray-100",children:[n.jsx("option",{value:"",children:l?"Section":"Loading…"}),d.map(t=>n.jsx("option",{value:String(t.id),children:t.name},t.id))]}),n.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer select-none",children:[n.jsx("input",{type:"checkbox",checked:e.student_type==="free",onChange:t=>{o(e.id,"student_type",t.target.checked?"free":"paid")},className:"h-4 w-4 accent-green-600"}),n.jsx("span",{className:r?"text-green-700 font-medium":"text-gray-600",children:"Free"})]}),n.jsx("button",{type:"button",onClick:()=>y(e.id),className:"text-red-600 text-sm ml-auto",title:"Remove enrollment",children:"✕"})]},e.id)}),n.jsx("button",{type:"button",onClick:j,className:"text-blue-600 text-xs self-start mt-1",children:"+ Add Enrollment"})]})}export{S as default};
