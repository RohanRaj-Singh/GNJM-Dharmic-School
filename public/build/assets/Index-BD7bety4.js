import{r as a,j as t,z as i,a as v}from"./app-DMgsIovw.js";import{A as S}from"./AdminLayout-DlV8HObD.js";import{u as _,f,g as F,a as M,b as I}from"./index-C9T86V1J.js";function k(){const[o,r]=a.useState([]),[h,b]=a.useState([]),[c,u]=a.useState(""),m=a.useRef(null);function x(){fetch("/admin/classes/data").then(e=>e.json()).then(r)}a.useEffect(x,[]);function g(e,s,l){r(d=>d.map((n,R)=>R===e?{...n,[s]:l}:n))}function j({row:e,column:s,autoFocus:l=!1}){const d=l?m:null;return t.jsx("input",{ref:d,defaultValue:e.original[s.id]??"",className:"w-full px-2 py-1 border rounded text-sm",onBlur:n=>g(e.index,s.id,n.target.value)})}function y({row:e,column:s}){return t.jsx("input",{type:"number",min:"0",className:"w-full px-2 py-1 border rounded text-sm",defaultValue:e.original[s.id]??0,onBlur:l=>g(e.index,s.id,Number(l.target.value))})}const C=a.useMemo(()=>[{accessorKey:"name",header:"Class Name",cell:({row:e,column:s})=>t.jsx(j,{row:e,column:s,autoFocus:e.original.__isNew})},{accessorKey:"default_monthly_fee",header:"Monthly Fee",cell:({row:e,column:s})=>t.jsx(y,{row:e,column:s})},{accessorKey:"sections_count",header:"Sections",cell:({row:e})=>t.jsx("span",{className:"text-gray-600",children:e.original.sections_count??0})}],[]),p=_({data:o,columns:C,getRowId:e=>e.id?`class-${e.id}`:e.__tempId,state:{sorting:h,globalFilter:c},onSortingChange:b,onGlobalFilterChange:u,getCoreRowModel:I(),getFilteredRowModel:M(),getSortedRowModel:F(),globalFilterFn:"includesString"});function w(){const e={id:null,__tempId:crypto.randomUUID(),name:"",default_monthly_fee:0,status:"active",sections_count:0,__isNew:!0};r(s=>[e,...s]),requestAnimationFrame(()=>{m.current?.focus()})}function N(){if(o.some(e=>!e.name?.trim())){i.error("Class name cannot be empty");return}v.post("/admin/classes/save",{classes:o},{onSuccess:()=>{i.success("Classes saved"),x()},onError:()=>i.error("Save failed")})}return t.jsxs(S,{title:"Classes",children:[t.jsxs("div",{className:"flex flex-wrap justify-between gap-3 mb-4",children:[t.jsx("input",{className:"px-3 py-2 border rounded text-sm w-64",placeholder:"Search classes…",value:c,onChange:e=>u(e.target.value)}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"+ Add Class"}),t.jsx("button",{onClick:N,className:"px-4 py-2 bg-green-600 text-white rounded",children:"Save Changes"})]})]}),t.jsx("div",{className:"bg-white border rounded overflow-auto",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 border-b",children:p.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(s=>t.jsxs("th",{className:"px-3 py-2 text-left font-medium cursor-pointer",onClick:s.column.getToggleSortingHandler(),children:[f(s.column.columnDef.header,s.getContext()),{asc:" ↑",desc:" ↓"}[s.column.getIsSorted()]??""]},s.id))},e.id))}),t.jsx("tbody",{children:p.getRowModel().rows.map(e=>t.jsx("tr",{className:"border-b hover:bg-gray-50",children:e.getVisibleCells().map(s=>t.jsx("td",{className:"px-3 py-2",children:f(s.column.columnDef.cell,s.getContext())},s.id))},e.id))})]})})]})}export{k as default};
