import{r as a,j as t}from"./app-CU8RJ2JX.js";import{A as L}from"./AdminLayout-DtTgDvcV.js";import{u as U,f as Y,b as I}from"./index-DNKFK4TQ.js";import{M as b}from"./MultiSelect-BVDRCvpt.js";import{g as G,f as p,a as H}from"./helper-BxvJq_M8.js";const J=[{key:"student_name",label:"Student Name"},{key:"father_name",label:"Father Name"},{key:"class_name",label:"Class"},{key:"section_name",label:"Section"},{key:"fee_title",label:"Fee Title"},{key:"month",label:"Month"},{key:"amount",label:"Amount"},{key:"is_paid",label:"Paid Status"}];function y({label:n,value:f}){return t.jsxs("div",{className:"bg-white border rounded p-4",children:[t.jsx("div",{className:"text-xs text-gray-500",children:n}),t.jsx("div",{className:"text-lg font-semibold",children:f})]})}function se(){const[n,f]=a.useState({class_ids:[],section_ids:[],student_ids:[],paid_status:["paid","unpaid"]}),[r,X]=a.useState(["student_name","class_name","section_name","fee_title","month","amount","is_paid"]),[d,k]=a.useState([]),[c,R]=a.useState(null),[z,A]=a.useState([]),[N,v]=a.useState(!1),[S,C]=a.useState([]),[w,j]=a.useState([]),[E,_]=a.useState([]),g=new Date().getFullYear(),[m,F]=a.useState(g),[h,M]=a.useState(null),P=a.useMemo(()=>S.map(e=>({value:e.id,label:e.name})),[S]),$=a.useMemo(()=>w.map(e=>({value:e.id,label:e.name})),[w]);a.useMemo(()=>E.map(e=>({value:e.id,label:e.name})),[E]);const T=a.useMemo(()=>Array.from({length:5},(e,s)=>{const u=g-3+s;return{value:u,label:String(u)}}),[g]),V=a.useMemo(()=>G(m),[m]);a.useEffect(()=>{fetch("/admin/classes/options").then(e=>e.json()).then(C).catch(()=>C([]))},[]),a.useEffect(()=>{if(!n.class_ids.length){j([]);return}const e=n.class_ids.map(s=>`class_ids[]=${s}`).join("&");fetch(`/admin/sections/options?${e}`).then(s=>s.json()).then(j).catch(()=>j([]))},[n.class_ids]),a.useEffect(()=>{if(!n.class_ids.length){_([]);return}const e=[...n.class_ids.map(s=>`class_ids[]=${s}`),...n.section_ids.map(s=>`section_ids[]=${s}`)].join("&");fetch(`/admin/students/options?${e}`).then(s=>s.json()).then(_).catch(()=>_([]))},[n.class_ids,n.section_ids]);async function q(){if(n.class_ids.length){v(!0);try{const s=await(await fetch("/admin/reports/build",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({report:"fees",...n,columns:r,year:m,month:h})})).json();R(s.summary??null),A(s.breakdowns?.by_class??[]),k(s.tables?.rows??[])}finally{v(!1)}}}const B=a.useMemo(()=>r.map(e=>({accessorKey:e,header:J.find(s=>s.key===e)?.label??e})),[r]),O=U({data:d,columns:B,getCoreRowModel:I()}),D=d.filter(e=>e.is_paid).length,K=d.filter(e=>!e.is_paid).length;return t.jsxs(L,{title:"Reports",children:[t.jsx("div",{className:"bg-white p-4 rounded border mb-4 space-y-4",children:t.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.jsx(b,{options:P,value:n.class_ids,placeholder:"Select class(es)",onChange:e=>f({...n,class_ids:e,section_ids:[],student_ids:[]})}),t.jsx(b,{options:T,value:[m],placeholder:"Select year",onChange:e=>{F(e[0]??g),M(null)}}),t.jsx(b,{options:V,value:h?[h]:[],placeholder:"Select month (optional)",onChange:e=>M(e[0]??null)}),t.jsx(b,{options:$,value:n.section_ids,placeholder:"Select section(s)",onChange:e=>f({...n,section_ids:e,student_ids:[]})}),t.jsx("button",{onClick:q,disabled:!n.class_ids.length||N,className:"px-4 py-2 rounded text-sm text-white bg-blue-600 disabled:bg-gray-400",children:N?"Buildingâ€¦":"Build Report"}),t.jsx("button",{disabled:!d.length,onClick:()=>{const e=document.createElement("form");e.method="POST",e.action="/admin/reports/export/csv";const s=document.createElement("input");s.type="hidden",s.name="_token",s.value=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e.appendChild(s);const u={report:"fees",...n,columns:r,year:m,month:h};Object.entries(u).forEach(([x,l])=>{if(Array.isArray(l))l.forEach(i=>{const o=document.createElement("input");o.type="hidden",o.name=`${x}[]`,o.value=i,e.appendChild(o)});else if(l!=null){const i=document.createElement("input");i.type="hidden",i.name=x,i.value=l,e.appendChild(i)}}),document.body.appendChild(e),e.submit(),e.remove()},className:`px-4 py-2 rounded text-sm font-medium border
        ${d.length?"bg-white hover:bg-gray-50 text-gray-800":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Export CSV"}),t.jsx("button",{disabled:!d.length,onClick:()=>{const e=document.createElement("form");e.method="POST",e.action="/admin/reports/export/pdf";const s=document.createElement("input");s.type="hidden",s.name="_token",s.value=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e.appendChild(s);const u={report:"fees",...n,columns:r,year:m,month:h};Object.entries(u).forEach(([x,l])=>{if(Array.isArray(l))l.forEach(i=>{const o=document.createElement("input");o.type="hidden",o.name=`${x}[]`,o.value=i,e.appendChild(o)});else if(l!=null){const i=document.createElement("input");i.type="hidden",i.name=x,i.value=l,e.appendChild(i)}}),document.body.appendChild(e),e.submit(),e.remove()},className:`px-4 py-2 rounded text-sm font-medium border
        ${d.length?"bg-white hover:bg-gray-50 text-gray-800":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Export PDF"})]})}),c&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[t.jsx(y,{label:"Total Fees",value:p(c.total_fees)}),t.jsx(y,{label:"Collected",value:p(c.total_collected)}),t.jsx(y,{label:"Pending",value:p(c.total_pending)}),t.jsx(y,{label:"Collection %",value:`${c.collection_percentage}%`})]}),c&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{className:"bg-white border rounded",children:[t.jsxs("div",{className:"px-4 py-3 border-b flex justify-between",children:[t.jsx("span",{className:"font-semibold text-green-700",children:"Paid Students"}),t.jsx("span",{className:"bg-green-600 text-white px-2 rounded",children:D})]}),t.jsx("ul",{className:"divide-y text-sm max-h-96 overflow-y-auto",children:d.filter(e=>e.is_paid).map((e,s)=>t.jsxs("li",{className:"px-4 py-3 flex justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.student_name}),e.father_name&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Father: ",e.father_name]}),t.jsx("div",{className:"text-xs text-gray-500",children:e.fee_title})]}),t.jsx("div",{className:"text-green-700 font-medium",children:p(e.amount)})]},s))})]}),t.jsxs("div",{className:"bg-white border rounded",children:[t.jsxs("div",{className:"px-4 py-3 border-b flex justify-between",children:[t.jsx("span",{className:"font-semibold text-red-600",children:"Unpaid Students"}),t.jsx("span",{className:"bg-red-600 text-white px-2 rounded",children:K})]}),t.jsx("ul",{className:"divide-y text-sm max-h-96 overflow-y-auto",children:d.filter(e=>!e.is_paid).map((e,s)=>t.jsxs("li",{className:"px-4 py-3 flex justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.student_name}),e.father_name&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Father: ",e.father_name]}),t.jsx("div",{className:"text-xs text-gray-500",children:e.fee_title})]}),t.jsx("div",{className:"text-red-600 font-medium",children:p(e.amount)})]},s))})]})]}),t.jsx("div",{className:"bg-white border rounded overflow-x-auto",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 border-b",children:O.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(s=>t.jsx("th",{className:"px-3 py-2 text-left",children:Y(s.column.columnDef.header,s.getContext())},s.id))},e.id))}),t.jsxs("tbody",{children:[O.getRowModel().rows.map(e=>t.jsx("tr",{className:"border-b",children:e.getVisibleCells().map(s=>t.jsx("td",{className:"px-3 py-2",children:s.column.id==="student_name"?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:s.getValue()}),e.original.father_name&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Father:"," ",e.original.father_name]})]}):s.column.id==="amount"?p(s.getValue()):s.column.id==="month"?H(s.getValue()):s.column.id==="is_paid"?s.getValue()?t.jsx("span",{className:"text-green-700 font-medium",children:"Paid"}):t.jsx("span",{className:"text-red-600 font-medium",children:"Unpaid"}):String(s.getValue()??"")},s.id))},e.id)),!d.length&&t.jsx("tr",{children:t.jsx("td",{colSpan:r.length,className:"p-6 text-center text-gray-500",children:"No data"})})]})]})})]})}export{se as default};
